!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.supersetEmbeddedSdk=t():e.supersetEmbeddedSdk=t()}(globalThis,(()=>(()=>{"use strict";var __webpack_modules__={98:(module,__webpack_exports__,__webpack_require__)=>{var enterModule;__webpack_require__.d(__webpack_exports__,{g:()=>Switchboard}),module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},Actions,reactHotLoader,leaveModule;class Switchboard{constructor({port:e,name:t="switchboard",debug:r=!1}){this.port=void 0,this.name=void 0,this.methods={},this.incrementor=1,this.debugMode=void 0,this.port=e,this.name=t,this.debugMode=r,e.addEventListener("message",(async e=>{this.log("message received",e);const t=e.data;if(isGet(t))this.port.postMessage(await this.getMethodResult(t));else if(isEmit(t)){const{method:e,args:r}=t,o=this.methods[e];o&&o(r)}}))}async getMethodResult({messageId:e,method:t,args:r}){const o=this.methods[t];if(null==o)return{switchboardAction:Actions.ERROR,messageId:e,error:`[${this.name}] Method "${t}" is not defined`};try{const t=await o(r);return{switchboardAction:Actions.REPLY,messageId:e,result:t}}catch(r){return this.logError(r),{switchboardAction:Actions.ERROR,messageId:e,error:`[${this.name}] Method "${t}" threw an error`}}}defineMethod(e,t){this.methods[e]=t}get(e,t){return new Promise(((r,o)=>{const n=this.getNewMessageId(),a=e=>{const t=e.data;if(t.messageId===n)if(this.port.removeEventListener("message",a),isReply(t))r(t.result);else{const e=isError(t)?t.error:"Unexpected response message";o(new Error(e))}};this.port.addEventListener("message",a),this.port.start();const s={switchboardAction:Actions.GET,method:e,messageId:n,args:t};this.port.postMessage(s)}))}emit(e,t){const r={switchboardAction:Actions.EMIT,method:e,args:t};this.port.postMessage(r)}start(){this.port.start()}log(...e){this.debugMode&&console.debug(`[${this.name}]`,...e)}logError(...e){console.error(`[${this.name}]`,...e)}getNewMessageId(){return`m_${this.name}_${this.incrementor++}`}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}function isGet(e){return e.switchboardAction===Actions.GET}function isReply(e){return e.switchboardAction===Actions.REPLY}function isEmit(e){return e.switchboardAction===Actions.EMIT}function isError(e){return e.switchboardAction===Actions.ERROR}!function(e){e.GET="get",e.REPLY="reply",e.EMIT="emit",e.ERROR="error"}(Actions||(Actions={})),reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(Switchboard,"Switchboard","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isGet,"isGet","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isReply,"isReply","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isEmit,"isEmit","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isError,"isError","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{embedDashboard:()=>M});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{exclude:()=>v,extract:()=>_,parse:()=>b,parseUrl:()=>w,pick:()=>k,stringify:()=>h,stringifyUrl:()=>y});const t={visible:"show_filters",expanded:"expand_filters"},r="%[a-f0-9]{2}",o=new RegExp("("+r+")|([^%]+?)","gi"),n=new RegExp("("+r+")+","gi");function a(e,t){try{return[decodeURIComponent(e.join(""))]}catch{}if(1===e.length)return e;t=t||1;const r=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],a(r),a(o))}function s(e){try{return decodeURIComponent(e)}catch{let t=e.match(o)||[];for(let r=1;r<t.length;r++)t=(e=a(t,r).join("")).match(o)||[];return e}}function i(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===e||""===t)return[];const r=e.indexOf(t);return-1===r?[]:[e.slice(0,r),e.slice(r+t.length)]}function c(e,t){const r={};if(Array.isArray(t))for(const o of t){const t=Object.getOwnPropertyDescriptor(e,o);t?.enumerable&&Object.defineProperty(r,o,t)}else for(const o of Reflect.ownKeys(e)){const n=Object.getOwnPropertyDescriptor(e,o);n.enumerable&&t(o,e[o],e)&&Object.defineProperty(r,o,n)}return r}const d=Symbol("encodeFragmentIdentifier");function u(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)):encodeURIComponent(e):e}function p(e,t){return t.decode?function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return decodeURIComponent(e)}catch{return function(e){const t={"%FE%FF":"��","%FF%FE":"��"};let r=n.exec(e);for(;r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{const e=s(r[0]);e!==r[0]&&(t[r[0]]=e)}r=n.exec(e)}t["%C2"]="�";const o=Object.keys(t);for(const r of o)e=e.replace(new RegExp(r,"g"),t[r]);return e}(e)}}(e):e}function f(e){return Array.isArray(e)?e.sort():"object"==typeof e?f(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function m(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function g(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function _(e){const t=(e=m(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function b(e,t){u((t={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...t}).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,o)=>{t=/\[(\d*)]$/.exec(e),e=e.replace(/\[\d*]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=r):o[e]=r};case"bracket":return(e,r,o)=>{t=/(\[])$/.exec(e),e=e.replace(/\[]$/,""),t?void 0!==o[e]?o[e]=[...o[e],r]:o[e]=[r]:o[e]=r};case"colon-list-separator":return(e,r,o)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==o[e]?o[e]=[...o[e],r]:o[e]=[r]:o[e]=r};case"comma":case"separator":return(t,r,o)=>{const n="string"==typeof r&&r.includes(e.arrayFormatSeparator),a="string"==typeof r&&!n&&p(r,e).includes(e.arrayFormatSeparator);r=a?p(r,e):r;const s=n||a?r.split(e.arrayFormatSeparator).map((t=>p(t,e))):null===r?r:p(r,e);o[t]=s};case"bracket-separator":return(t,r,o)=>{const n=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!n)return void(o[t]=r?p(r,e):r);const a=null===r?[]:r.split(e.arrayFormatSeparator).map((t=>p(t,e)));void 0!==o[t]?o[t]=[...o[t],...a]:o[t]=a};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[...[r[e]].flat(),t]:r[e]=t}}}(t),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const n of e.split("&")){if(""===n)continue;const e=t.decode?n.replace(/\+/g," "):n;let[a,s]=i(e,"=");void 0===a&&(a=e),s=void 0===s?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?s:p(s,t),r(p(a,t),s,o)}for(const[e,r]of Object.entries(o))if("object"==typeof r&&null!==r)for(const[e,o]of Object.entries(r))r[e]=g(o,t);else o[e]=g(r,t);return!1===t.sort?o:(!0===t.sort?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce(((e,t)=>{const r=o[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=f(r):e[t]=r,e}),Object.create(null))}function h(e,t){if(!e)return"";u((t={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...t}).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],o=function(e){switch(e.arrayFormat){case"index":return t=>(r,o)=>{const n=r.length;return void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,[l(t,e),"[",n,"]"].join("")]:[...r,[l(t,e),"[",l(n,e),"]=",l(o,e)].join("")]};case"bracket":return t=>(r,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,[l(t,e),"[]"].join("")]:[...r,[l(t,e),"[]=",l(o,e)].join("")];case"colon-list-separator":return t=>(r,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,[l(t,e),":list="].join("")]:[...r,[l(t,e),":list=",l(o,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(o,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?o:(n=null===n?"":n,0===o.length?[[l(r,e),t,l(n,e)].join("")]:[[o,l(n,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,o)=>void 0===o||e.skipNull&&null===o||e.skipEmptyString&&""===o?r:null===o?[...r,l(t,e)]:[...r,[l(t,e),"=",l(o,e)].join("")]}}(t),n={};for(const[t,o]of Object.entries(e))r(t)||(n[t]=o);const a=Object.keys(n);return!1!==t.sort&&a.sort(t.sort),a.map((r=>{const n=e[r];return void 0===n?"":null===n?l(r,t):Array.isArray(n)?0===n.length&&"bracket-separator"===t.arrayFormat?l(r,t)+"[]":n.reduce(o(r),[]).join("&"):l(r,t)+"="+l(n,t)})).filter((e=>e.length>0)).join("&")}function w(e,t){t={decode:!0,...t};let[r,o]=i(e,"#");return void 0===r&&(r=e),{url:r?.split("?")?.[0]??"",query:b(_(e),t),...t&&t.parseFragmentIdentifier&&o?{fragmentIdentifier:p(o,t)}:{}}}function y(e,t){t={encode:!0,strict:!0,[d]:!0,...t};const r=m(e.url).split("?")[0]||"";let o=h({...b(_(e.url),{sort:!1}),...e.query},t);o&&(o=`?${o}`);let n=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);if(e.fragmentIdentifier){const o=new URL(r);o.hash=e.fragmentIdentifier,n=t[d]?o.hash:`#${e.fragmentIdentifier}`}return`${r}${o}${n}`}function k(e,t,r){r={parseFragmentIdentifier:!0,[d]:!1,...r};const{url:o,query:n,fragmentIdentifier:a}=w(e,r);return y({url:o,query:c(n,t),fragmentIdentifier:a},r)}function v(e,t,r){return k(e,Array.isArray(t)?e=>!t.includes(e):(e,r)=>!t(e,r),r)}const E=e;var x=__webpack_require__(98);function j(e){this.message=e}j.prototype=new Error,j.prototype.name="InvalidCharacterError";var S="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new j("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,n=0,a=0,s="";o=t.charAt(a++);~o&&(r=n%4?64*r+o:o,n++%4)?s+=String.fromCharCode(255&r>>(-2*n&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return s};function A(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(S(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return S(t)}}function I(e){this.message=e}I.prototype=new Error,I.prototype.name="InvalidTokenError";function O(e){const t=function(e,t){if("string"!=typeof e)throw new I("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(A(e.split(".")[r]))}catch(e){throw new I("Invalid token specified: "+e.message)}}(e),r=new Date(/[^0-9\.]/g.test(t.exp)?t.exp:1e3*parseFloat(t.exp));return("Invalid Date"!==r.toString()?Math.max(1e4,r.getTime()-Date.now()):3e5)-5e3}async function M(e){let{id:r,supersetDomain:o,mountPoint:n,fetchGuestToken:a,dashboardUiConfig:s,debug:i=!1}=e;if(!r||"string"!=typeof r)throw new Error("Invalid id");if(!o||"string"!=typeof o)throw new Error("Invalid supersetDomain");if(!(n&&n instanceof HTMLElement))throw new Error("Invalid mountPoint");if(!a||"function"!=typeof a)throw new Error("Invalid fetchGuestToken");function c(){if(i){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];console.debug(`[superset-embedded-sdk][dashboard ${r}]`,...t)}}c("embedding");const[d,u]=await Promise.all([a(),async function(){return new Promise((e=>{const a=document.createElement("iframe"),d=s?`?uiConfig=${function(){let e=0;return s&&(s.hideTitle&&(e+=1),s.hideTab&&(e+=2),s.hideChartControls&&(e+=8)),e}()}`:"",u=function(e){return e&&0!==e.keys.length?(Object.keys(e).forEach((e=>{t.hasOwnProperty(e)||c(`Filter key '${e}' not allowed in filterConfig`)})),e):{}}(s?.filters),l=s?.params||{},p=E.stringify({...l,...u},{encode:!1});a.sandbox.add("allow-same-origin"),a.sandbox.add("allow-scripts"),a.sandbox.add("allow-presentation"),a.sandbox.add("allow-downloads"),a.sandbox.add("allow-forms"),a.sandbox.add("allow-popups"),a.sandbox.add("allow-top-navigation"),a.addEventListener("load",(()=>{const t=new MessageChannel,r=t.port1,n=t.port2;a.contentWindow.postMessage({type:"__embedded_comms__",handshake:"port transfer"},o,[n]),c("sent message channel to the iframe"),e(new x.g({port:r,name:"superset-embedded-sdk",debug:i}))})),a.src=`${o}/embedded/${r}${d}${p}`,n.replaceChildren(a),c("placed the iframe")}))}()]);return u.emit("guestToken",{guestToken:d}),c("sent guest token"),setTimeout((async function e(){const t=await a();u.emit("guestToken",{guestToken:t}),setTimeout(e,O(t))}),O(d)),{getScrollSize:()=>u.get("getScrollSize"),unmount:function(){c("unmounting"),n.replaceChildren()},getDashboardPermalink:e=>u.get("getDashboardPermalink",{anchor:e}),getActiveTabs:()=>u.get("getActiveTabs")}}})(),__webpack_exports__})()));
//# sourceMappingURL=index.js.map